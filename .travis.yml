---
dist: xenial
language: python
python: 3.7
# pre-commit hooks can use Docker, so we should go ahead and enable it
services: docker

env:
  global:
    - AWS_DEFAULT_REGION="us-east-1"
    # AWS_ACCESS_KEY_ID
    - secure: "ApDabdwBDxP5Z5xQs4znymHAurWk9aaWoRhp5IvXNAaOYVFWDMVijLe\
      J1iasCWCu2xr5o5Pm4vBOc/1gOrB0MkYEGl4eNEz0DfmJgmqgI8v+LmiVIWFO52n\
      n+I+m8+M+3h3uwJRHHOGRttSm8HMskY1UVbjqWMXjAWI5JqC6oaUZWAMXFT9DMV3\
      tOOvVzImq2teGKzzz43BjfvjuEv3OTq3dKuUFuNyZUQZcUX5AJ9b44LpLj+9wUUF\
      daXmNEyzehx867YppiwnFAJuzggV3XRfXwjfUQrPOJ0yWtQYlZ1vSlDYygroNIsQ\
      U//JMXtbnRQZuAIxS+PrHt7i+cDlYRkq4MTrQvfJVswDCOt1gaSKgk/jYOis5SG5\
      FtErKnV4cBilDjeMqAMX1hL4ltvucb5mepn3SOCKkSu6iA4rY7tAWX3pmsu+Zlcm\
      11iJVW8w0M/ZXRvIi4fwlZIRbUXJA4oqW68KXlZmNtRjchhkFxxbQLMUlX3AavtB\
      x3FlCH4t5fhjMg6zdiNUcCRwrhT3gw8xMzRuop/oG3+ap3fpQ2OXlyVWT7H02Hw3\
      HPivG82ynB3pJVbEhRjyNxjL5wlYGBaV+xiVm2+/yCAIX/kD91UKvoasSkUY4Lch\
      WkvKFdOWlsm0aZAnHGm/ZWAnHarC9wc1ZWAtQfbUlMqF9ULEsgkk="
    # AWS_SECRET_ACCESS_KEY
    - secure: "Lf/IYbvaEOks0hQ+zxCs+ArjUpd9vASSMhJhhr/5R8NfExGqo7Hdm7r\
      xP+zZx2hG4PpD9cHEkRe0aVJ9Qnpz3x2Tjefs8d1YOkN15zjkBgq14nqCGwmPHV5\
      0JcIgQlzPHoKuJQ2viIrGPLdKvK8d8rRii+bOcNB83dhinnLfKNNDBh2rw2E6gKv\
      RBxc0AunK1KWjqGL//Ppz7ADQmvsxaODQrzRakTgRr/MEIiyTp1I1OuWBnV145pD\
      Q0OCqzPPurygiVCbYDmKRY5JHVYuw2tRVfe9PXxW8opYw/A/8ujC5tyZgdCx/hj1\
      3wbENOxePE+2ghxzB/CfunkJy0XOFh0NqfAHmJTUEGe2+X4frMh/GjiPh0VXEk37\
      2VP8XhfxmFAuBrvtilbqxWdc4R5r3QgZUoRfJYOTgZQ4RcIGOmB6mN7tmX94wA91\
      BTNbDEyuY2bvowWEU66IaezNF7TTfQEZc48Ei5C4MCgSxCmvufB0IWjSNCdAkNVt\
      cOr00ZiiRU7+7LyMHmAWcMJP41kXUB1yOoqVqdaDLjnESbRP97ta/DeSRVC2qFkS\
      4DWr08RA7QO6dZmS4jKoxtx2rTFpO3mokUdXm3Zs34vM9lgB9rVPkebt4wQFvHwa\
      5W2NkcXQIaBkmrvsNLSP+wpPxKeIiY6S6KwFB3mCNhuPTP3ZXKM4="

# Install terraform and terraform-doc
before_install:
  - >
    wget
    https://releases.hashicorp.com/terraform/0.12.3/terraform_0.12.3_linux_amd64.zip
    -O terraform.zip
  - sudo unzip terraform.zip -d /opt/terraform
  - sudo ln -s /opt/terraform/terraform /usr/bin/terraform
  - rm -f terraform.zip
  - go get github.com/segmentio/terraform-docs

# Cache pip packages and pre-commit plugins to speed up builds
cache:
  pip: true
  directories:
    - $HOME/.cache/pre-commit

install:
  - pip install --upgrade -r requirements-test.txt

script:
  - pre-commit run --all-files
  - molecule test
