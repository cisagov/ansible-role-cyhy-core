---
dist: xenial
language: python
python: 3.7
# pre-commit hooks can use Docker, so we should go ahead and enable it
services: docker

env:
  global:
    - AWS_DEFAULT_REGION="us-east-1"
    # AWS_ACCESS_KEY_ID
    - secure: "ApDabdwBDxP5Z5xQs4znymHAurWk9aaWoRhp5IvXNAaOYVFWDMVijLe\
      J1iasCWCu2xr5o5Pm4vBOc/1gOrB0MkYEGl4eNEz0DfmJgmqgI8v+LmiVIWFO52n\
      n+I+m8+M+3h3uwJRHHOGRttSm8HMskY1UVbjqWMXjAWI5JqC6oaUZWAMXFT9DMV3\
      tOOvVzImq2teGKzzz43BjfvjuEv3OTq3dKuUFuNyZUQZcUX5AJ9b44LpLj+9wUUF\
      daXmNEyzehx867YppiwnFAJuzggV3XRfXwjfUQrPOJ0yWtQYlZ1vSlDYygroNIsQ\
      U//JMXtbnRQZuAIxS+PrHt7i+cDlYRkq4MTrQvfJVswDCOt1gaSKgk/jYOis5SG5\
      FtErKnV4cBilDjeMqAMX1hL4ltvucb5mepn3SOCKkSu6iA4rY7tAWX3pmsu+Zlcm\
      11iJVW8w0M/ZXRvIi4fwlZIRbUXJA4oqW68KXlZmNtRjchhkFxxbQLMUlX3AavtB\
      x3FlCH4t5fhjMg6zdiNUcCRwrhT3gw8xMzRuop/oG3+ap3fpQ2OXlyVWT7H02Hw3\
      HPivG82ynB3pJVbEhRjyNxjL5wlYGBaV+xiVm2+/yCAIX/kD91UKvoasSkUY4Lch\
      WkvKFdOWlsm0aZAnHGm/ZWAnHarC9wc1ZWAtQfbUlMqF9ULEsgkk="
    # AWS_SECRET_ACCESS_KEY
    - secure: "H+NA7KvV6iU9sRWYyp5VnDW21N7WJIcya7Y+yq5OnX8WLi3PewgWNHB\
      84sVHdMRTmPqerbOZkQtiwsOWfYH2CIwBohEX+t9hFDW0o8IU1oqW5LT9gVIMw+w\
      rnKFJIllzntoC+lO0kcf3TIs+A3aGitWqvoB5v92vTZsDeg088nTICfhxU1bvmhr\
      8MLOFXBClF88J24Lc0MI7LxNXwdlqpcLtLcYo0/s2+Q4cTNR/RdBVj2G4DGI76zR\
      A9ZWnuRU2ooV35XB9JoWwiqR/mw6ahy0SDHWUhzU8Samn0VdwTQ5Og9U+HPl1qNL\
      079nk5D0YDi3zOxix14w7X7rV4SRGYUxIIsyX5Y0fxMZKQJcmWCRD9o5HP/XyO/r\
      jes3SkhSoaUzG+xDuXbNzCF8Q047HB7UvPAghxOxPu876aqBj/O6WouQ+7OOYki6\
      Ex4dyv6bkVdfHPKOhE1GMcW+WKEc2xnvDD2FdR0mVWWKnAAbTieXMwEE7qTMBM+R\
      taah2R9XrXyIChlunabbJvcNktNNZDMnzTVtxKrMG5YXr3vstlC5H0SgLF4n4CTV\
      6ycDYPTP2sfHFnzHfXkuayTF8dfS1CEgkjxJVUrOJLQKtDaeJrlrG8RBUx7/1Gho\
      Q8WjJlM3/omtY9rjDy8oIghlRpaJRS2VU+TKyUqOix59uUt8i7BI="

# Install terraform and terraform-doc
before_install:
  - >
    wget
    https://releases.hashicorp.com/terraform/0.12.3/terraform_0.12.3_linux_amd64.zip
    -O terraform.zip
  - sudo unzip terraform.zip -d /opt/terraform
  - sudo ln -s /opt/terraform/terraform /usr/bin/terraform
  - rm -f terraform.zip
  - go get github.com/segmentio/terraform-docs

# Cache pip packages and pre-commit plugins to speed up builds
cache:
  pip: true
  directories:
    - $HOME/.cache/pre-commit

install:
  - pip install --upgrade -r requirements-test.txt

script:
  - pre-commit run --all-files
  - molecule test
