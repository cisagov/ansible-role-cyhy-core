---
dist: xenial
language: python
python: 3.7
# pre-commit hooks can use Docker, so we should go ahead and enable it
services: docker

env:
  global:
    - AWS_DEFAULT_REGION=us-east-1
    # AWS_ACCESS_KEY_ID
    - secure: "H1A08xLRt0K5pK0YXNcc+V/cbe2tztA9250Tn0nYyLtyhx5uj2mRMkt\
      C5gpnKmuG/1L2PiOz1rh/jYxcO2xrNHMD93hLZ+mJPclKtCCnrp6uuLaxymP3DNU\
      3XcKSsQdtLvzyS/wOdqJamvffq3C4h4wNszgv+l0CnyiZKVCQvJeJ8PvKBVGaDYf\
      IIjhpXd+PdgokMyLxH9I83efCA3m3Y//9gdEaSxHC7qxex/xIWHuKKBbpBhnHK4v\
      2LuhdQMiYviv4UU9TDaY8tgBSpyEAlS51Jl+XxzEKOOzJ+UtG0m3QCx0cdkFKDOI\
      L5C8Ah3jxoroaiUP0XDRosq78eT1hJWILnhJ/2/gnTOAceSpOSxeWydir2HM1R/1\
      TQHAPm/tFnIEhhu4a/FHVHYOXlUfN9PZza0VTnxZI7PTUObMq+Tax0c+QFsuamK9\
      37Y9D99mbJbfIE5EuZY7gMZ5Ht9VT362wf2rQAr6gSVMNgEjTyAxftXxC1kshX/4\
      Q5ScNIVuy29fjjW8uM95PW067L9RR7xJqKNafXkY58ISaMO5VRgUEsy1Kg+jYZtW\
      4jsVQbVXowP7aWX2h4j3Eco5CEXIXslCQB3h4gMikqRNP5lRL5S6xrR+C1T4jtFp\
      zCasC3Fg3nvmDr/2Bt8uK7YzD4JaXC4szrAWO6yTRDdhoM9W83Lo="
    # AWS_SECRET_ACCESS_KEY
    - secure: "Ct0cT7q0F9LGluNCWEXfOJW+0cUby5yP2V2Wnd4ZeoMpZXK/1//doaN\
      66mSPlJPXGERyueqL1PGXhei9lVVlGabPs4C0Z8W6bJ8whGMmo2EGXIAleOahJOb\
      mQzG8vcBMWQ9PS9eGROTA+4isiTfW4j2WrXLKAkzpIT+oJaGyGpa0PpZtcGQEmSk\
      YQnvnuN4z4zF/HsW4tFUHWbwBZ+Taern4M/nAAp4uNRb7RQYkPVOcsQIuPSYI8sG\
      VCznuZ57/IaLz0b9YQOQYZy/+Y0r+jduzwZb6FBepbiYhnh8KeHPC17f5DWJ8RyH\
      qYPJTQxllF5fuCbnp2VnnnP9I1uOZSVHGe/TlpzzYrqJh6LBPmSORqDftlQL3TJC\
      mSunvU5RqzoCUNP1wInsj2xlEwRyhsal8qWQyojqFniLjAyT2I4fbAaU2a1ZxCTc\
      csCPQUUyklhWDKL4lzNlc63eTLFlWQfn/P5Gu49gV0Q0QteW9ASq0BiMgYiPy+nU\
      qfmsYKjqv+MeEquQGllklhF0/xl/ERunYLnVukBiuvLd/v+A8hiJpTm7WaDZClLj\
      9LJ0Fh6fHsc3ZVji9ig4we/EZvJCvVS9VyIV5DOire3KRyC7TZXnm6Fe1anEUuUH\
      9+iMAiyj4n06amzK1hvb8ZFqaUf9jTI8fZbZirLaxNWpJzUt4Zr4="

# Install terraform and terraform-doc
before_install:
  - >
    wget
    https://releases.hashicorp.com/terraform/0.12.3/terraform_0.12.3_linux_amd64.zip
    -O terraform.zip
  - sudo unzip terraform.zip -d /opt/terraform
  - sudo ln -s /opt/terraform/terraform /usr/bin/terraform
  - rm -f terraform.zip
  - go get github.com/segmentio/terraform-docs

# Cache pip packages and pre-commit plugins to speed up builds
cache:
  pip: true
  directories:
    - $HOME/.cache/pre-commit

install:
  - pip install --upgrade -r requirements-test.txt

script:
  - pre-commit run --all-files
  - molecule test
